class "ShipmentServer"

function ShipmentServer:__init()
    self.m_EngineUpdateEvent = Events:Subscribe("Engine:Update", self, self.OnEngineUpdate)
    self.m_PlayerRespawnEvent = Events:Subscribe("Player:Respawn", self, self.OnPlayerRespawn)

    self.m_UpdateTick = 0.0
    self.m_UpdateTickMax = 2

    self.m_PointIndex = 1

    self.m_SpawnPoints = {
        LinearTransform(
        Vec3(0.629906, 0.000000, -0.776672),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.776672, 0.000000, 0.629906),
        Vec3(422.708038, 208.642380, -1373.181519)
        ),
        LinearTransform(
        Vec3(0.133212, 0.000000, -0.991088),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.991088, 0.000000, 0.133212),
        Vec3(422.085938, 208.642380, -1371.213867)
        ),
        LinearTransform(
        Vec3(0.641662, 0.000000, -0.766988),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.766988, 0.000000, 0.641662),
        Vec3(422.040039, 208.642380, -1369.058594)
        ),
        LinearTransform(
        Vec3(0.641662, 0.000000, -0.766988),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.766988, 0.000000, 0.641662),
        Vec3(423.772461, 208.642380, -1367.608398)
        ),
        LinearTransform(
        Vec3(0.641662, 0.000000, -0.766988),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.766988, 0.000000, 0.641662),
        Vec3(424.906250, 208.642380, -1369.525391)
        ),
        LinearTransform(
        Vec3(0.641662, 0.000000, -0.766988),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.766988, 0.000000, 0.641662),
        Vec3(428.063477, 208.642380, -1372.110352)
        ),
        LinearTransform(
        Vec3(0.928303, 0.000000, -0.371824),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.371824, 0.000000, 0.928303),
        Vec3(431.016602, 208.642380, -1372.839844)
        ),
        LinearTransform(
        Vec3(0.993757, 0.000000, 0.111562),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.111562, 0.000000, 0.993757),
        Vec3(434.002930, 208.642380, -1372.847656)
        ),
        LinearTransform(
        Vec3(0.999432, 0.000000, 0.033698),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.033698, 0.000000, 0.999432),
        Vec3(436.597656, 208.642380, -1373.181641)
        ),
        LinearTransform(
        Vec3(-0.041162, 0.000000, 0.999152),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.999152, 0.000000, -0.041162),
        Vec3(443.098633, 208.715622, -1371.295898)
        ),
        LinearTransform(
        Vec3(-0.041162, 0.000000, 0.999152),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.999152, 0.000000, -0.041162),
        Vec3(442.219727, 208.715622, -1372.728516)
        ),
        LinearTransform(
        Vec3(-0.041162, 0.000000, 0.999152),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.999152, 0.000000, -0.041162),
        Vec3(438.497070, 208.715622, -1372.650391)
        ),
        LinearTransform(
        Vec3(0.756071, 0.000000, 0.654490),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.654490, 0.000000, 0.756071),
        Vec3(436.732300, 208.648239, -1369.125977)
        ),
        LinearTransform(
        Vec3(0.998625, 0.000000, 0.052424),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.052424, 0.000000, 0.998625),
        Vec3(438.949219, 208.648239, -1367.759766)
        ),
        LinearTransform(
        Vec3(0.999999, 0.000000, 0.001688),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.001688, 0.000000, 0.999999),
        Vec3(441.313477, 208.648239, -1367.688477)
        ),
        LinearTransform(
        Vec3(0.998255, 0.000000, 0.059054),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.059054, 0.000000, 0.998255),
        Vec3(443.486328, 208.648239, -1367.639648)
        ),
        LinearTransform(
        Vec3(0.433117, 0.000000, -0.901338),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.901338, 0.000000, 0.433117),
        Vec3(444.812500, 208.648239, -1369.086914)
        ),
        LinearTransform(
        Vec3(0.590648, 0.000000, -0.806929),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.806929, 0.000000, 0.590648),
        Vec3(444.708008, 208.648239, -1372.108398)
        ),
        LinearTransform(
        Vec3(0.999950, 0.000000, -0.010019),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.010019, 0.000000, 0.999950),
        Vec3(447.379883, 208.648239, -1373.041992)
        ),
        LinearTransform(
        Vec3(0.997383, 0.000000, 0.072305),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.072305, 0.000000, 0.997383),
        Vec3(450.083984, 208.648239, -1373.021240)
        ),
        LinearTransform(
        Vec3(0.997240, 0.000000, 0.074251),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.074251, 0.000000, 0.997240),
        Vec3(453.233398, 208.648239, -1372.771484)
        ),
        LinearTransform(
        Vec3(0.995958, 0.000000, 0.089816),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.089816, 0.000000, 0.995958),
        Vec3(456.895508, 208.648239, -1372.955078)
        ),
        LinearTransform(
        Vec3(0.526665, 0.000000, 0.850073),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.850073, 0.000000, 0.526665),
        Vec3(459.243164, 208.648239, -1371.190430)
        ),
        LinearTransform(
        Vec3(0.526665, 0.000000, 0.850073),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.850073, 0.000000, 0.526665),
        Vec3(456.892578, 208.648239, -1370.468750)
        ),
        LinearTransform(
        Vec3(0.526665, 0.000000, 0.850073),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.850073, 0.000000, 0.526665),
        Vec3(454.317383, 208.648239, -1369.598633)
        ),
        LinearTransform(
        Vec3(0.903839, 0.000000, 0.427874),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.427874, 0.000000, 0.903839),
        Vec3(456.610352, 208.648239, -1367.759766)
        ),
        LinearTransform(
        Vec3(0.015048, 0.000000, 0.999887),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.999887, 0.000000, 0.015048),
        Vec3(459.003906, 208.648239, -1365.979492)
        ),
        LinearTransform(
        Vec3(0.027930, 0.000000, 0.999610),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.999610, 0.000000, 0.027930),
        Vec3(456.520508, 208.648239, -1362.551758)
        ),
        LinearTransform(
        Vec3(0.108934, 0.000000, 0.994049),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.994049, 0.000000, 0.108934),
        Vec3(458.943359, 208.649216, -1360.920898)
        ),
        LinearTransform(
        Vec3(-0.725636, 0.000000, 0.688078),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.688078, 0.000000, -0.725636),
        Vec3(459.500977, 208.649216, -1357.377930)
        ),
        LinearTransform(
        Vec3(-0.990601, 0.000000, 0.136785),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.136785, 0.000000, -0.990601),
        Vec3(456.864258, 208.711716, -1355.869141)
        ),
        LinearTransform(
        Vec3(0.968486, 0.000000, -0.249069),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.249069, 0.000000, 0.968486),
        Vec3(458.479492, 208.711716, -1351.565430)
        ),
        LinearTransform(
        Vec3(-0.117441, 0.000000, 0.993080),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.993080, 0.000000, -0.117441),
        Vec3(458.767578, 208.650192, -1348.086914)
        ),
        LinearTransform(
        Vec3(-0.149945, 0.000000, 0.988694),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.988694, 0.000000, -0.149945),
        Vec3(459.045898, 208.650192, -1344.490234)
        ),
        LinearTransform(
        Vec3(-0.252777, 0.000000, 0.967525),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.967525, 0.000000, -0.252777),
        Vec3(459.026367, 208.650192, -1341.136719)
        ),
        LinearTransform(
        Vec3(-0.431446, 0.000000, 0.902139),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.902139, 0.000000, -0.431446),
        Vec3(458.732422, 208.650192, -1338.271484)
        ),
        LinearTransform(
        Vec3(-0.998949, 0.000000, 0.045826),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.045826, 0.000000, -0.998949),
        Vec3(455.876953, 208.650192, -1337.058594)
        ),
        LinearTransform(
        Vec3(-0.474604, 0.000000, 0.880199),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.880199, 0.000000, -0.474604),
        Vec3(454.685547, 208.650192, -1338.496094)
        ),
        LinearTransform(
        Vec3(-0.685825, 0.000000, 0.727766),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.727766, 0.000000, -0.685825),
        Vec3(456.244141, 208.650192, -1341.403320)
        ),
        LinearTransform(
        Vec3(-0.692897, 0.000000, 0.721037),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.721037, 0.000000, -0.692897),
        Vec3(454.542969, 208.650192, -1342.243164)
        ),
        LinearTransform(
        Vec3(-0.999374, 0.000000, -0.035367),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.035367, 0.000000, -0.999374),
        Vec3(450.966797, 208.650192, -1336.260742)
        ),
        LinearTransform(
        Vec3(-0.999756, 0.000000, -0.022097),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.022097, 0.000000, -0.999756),
        Vec3(447.523438, 208.649216, -1336.222656)
        ),
        LinearTransform(
        Vec3(-0.959695, 0.000000, -0.281043),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.281043, 0.000000, -0.959695),
        Vec3(444.924805, 208.649216, -1335.495117)
        ),
        LinearTransform(
        Vec3(0.005750, 0.000000, -0.999983),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.999983, 0.000000, 0.005750),
        Vec3(443.158203, 208.718552, -1338.470703)
        ),
        LinearTransform(
        Vec3(0.035808, 0.000000, -0.999359),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.999359, 0.000000, 0.035808),
        Vec3(440.032227, 208.718552, -1339.469727)
        ),
        LinearTransform(
        Vec3(-0.645576, 0.000000, -0.763696),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.763696, 0.000000, -0.645576),
        Vec3(444.805664, 208.651169, -1340.363281)
        ),
        LinearTransform(
        Vec3(-0.999529, 0.000000, -0.030683),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.030683, 0.000000, -0.999529),
        Vec3(442.532227, 208.651169, -1340.398438)
        ),
        LinearTransform(
        Vec3(-0.999543, 0.000000, 0.030222),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.030222, 0.000000, -0.999543),
        Vec3(439.066406, 208.651169, -1340.456055)
        ),
        LinearTransform(
        Vec3(-0.444081, 0.000000, 0.895987),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.895987, 0.000000, -0.444081),
        Vec3(436.824219, 208.651169, -1338.325195)
        ),
        LinearTransform(
        Vec3(-0.761389, 0.000000, 0.648295),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.648295, 0.000000, -0.761389),
        Vec3(436.494141, 208.642380, -1335.405273)
        ),
        LinearTransform(
        Vec3(-0.996123, 0.000000, -0.087971),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.087971, 0.000000, -0.996123),
        Vec3(432.616211, 208.642380, -1335.099609)
        ),
        LinearTransform(
        Vec3(-0.996965, 0.000000, -0.077854),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.077854, 0.000000, -0.996965),
        Vec3(428.778320, 208.642380, -1335.021484)
        ),
        LinearTransform(
        Vec3(-0.989717, 0.000000, -0.143039),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.143039, 0.000000, -0.989717),
        Vec3(424.652344, 208.642380, -1335.096680)
        ),
        LinearTransform(
        Vec3(-0.833414, 0.000000, -0.552649),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.552649, 0.000000, -0.833414),
        Vec3(422.194336, 208.642380, -1336.123047)
        ),
        LinearTransform(
        Vec3(-0.804299, 0.000000, -0.594225),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.594225, 0.000000, -0.804299),
        Vec3(424.978516, 208.642380, -1338.290039)
        ),
        LinearTransform(
        Vec3(-0.788720, 0.000000, -0.614752),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.614752, 0.000000, -0.788720),
        Vec3(429.350586, 208.642380, -1337.821289)
        ),
        LinearTransform(
        Vec3(-0.820015, 0.000000, -0.572341),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.572341, 0.000000, -0.820015),
        Vec3(430.893555, 208.642380, -1339.981445)
        ),
        LinearTransform(
        Vec3(-0.143308, 0.000000, -0.989678),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.989678, 0.000000, -0.143308),
        Vec3(422.490234, 208.642380, -1343.043945)
        ),
        LinearTransform(
        Vec3(-0.522592, 0.000000, -0.852583),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.852583, 0.000000, -0.522592),
        Vec3(424.585938, 208.642380, -1343.770508)
        ),
        LinearTransform(
        Vec3(0.054526, 0.000000, -0.998512),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.998512, 0.000000, 0.054526),
        Vec3(422.514648, 208.642380, -1346.448242)
        ),
        LinearTransform(
        Vec3(0.311295, 0.000000, -0.950313),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.950313, 0.000000, 0.311295),
        Vec3(422.595703, 208.642380, -1349.795898)
        ),
        LinearTransform(
        Vec3(0.948458, 0.000000, 0.316902),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(-0.316902, 0.000000, 0.948458),
        Vec3(423.534180, 208.712692, -1352.910156)
        ),
        LinearTransform(
        Vec3(-0.919815, 0.000000, -0.392352),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.392352, 0.000000, -0.919815),
        Vec3(424.983398, 208.712692, -1357.570313)
        ),
        LinearTransform(
        Vec3(-0.962182, 0.000000, -0.272408),
        Vec3(0.000000, 1.000000, 0.000000),
        Vec3(0.272408, 0.000000, -0.962182),
        Vec3(422.318359, 208.648239, -1358.032227)
        ),
    }
end

function ShipmentServer:OnEngineUpdate(p_DeltaTime, p_SimulationDeltaTime)
    if self.m_UpdateTick >= self.m_UpdateTickMax then
        self.m_UpdateTick = 0.0

        --print(RCON:SendCommand("modList.List"))
        --print(RCON:SendCommand("modList.ListRunning"))
        --print(RCON:SendCommand("modList.Available"))
    end

    self.m_UpdateTick = self.m_UpdateTick + p_DeltaTime
end

function ShipmentServer:OnPlayerRespawn(p_Player)
    -- Validate player
    if p_Player == nil then
        print("invalid player during respawn")
        return
    end

    -- Get soldier
    local s_Soldier = p_Player.soldier
    if s_Soldier == nil then
        print("invalid soldier during respawn")
        return
    end

    -- Check if our point index is beyond the number of spawn points we have
    if self.m_PointIndex >= #self.m_SpawnPoints then
        print("spawn index wrapped around =[, add more spawnpoints")
        self.m_PointIndex = 1
    end

    local s_RandomIndex = math.random(1, #self.m_SpawnPoints)

    -- Get our selected transform
    local s_Transform = self.m_SpawnPoints[s_RandomIndex]

    -- Teleport player
    s_Soldier:SetTransform(s_Transform)
    print("set transform")
end

g_ShipmentServer = ShipmentServer()